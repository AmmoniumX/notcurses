#!/usr/bin/make -f

DEB_HOST_MULTIARCH?=$(shell dpkg-architecture -qDEB_HOST_MULTIARCH)

export DEB_BUILD_MAINT_OPTIONS = hardening=+all

export PYBUILD_NAME=notcurses

%:
	dh $@ --buildsystem=cmake

override_dh_auto_configure:
	dh_auto_configure -- -DDFSG_BUILD=ON

override_dh_auto_build:
	dh_auto_build
	cd python && python3 setup.py build_ext -L../obj-$(DEB_HOST_MULTIARCH) -I../include
	cd python && python3 setup.py build_py

override_dh_auto_install:
	dh_auto_install -B $(BUILDDIR)
	cd python && python3 setup.py install --prefix=/usr --skip-build --root=../debian/tmp --install-layout=deb --single-version-externally-managed
	rm -rf debian/tmp/usr/lib/python3/dist-packages/__pycache__
